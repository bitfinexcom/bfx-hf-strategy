<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>Home - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-Data.html">Data</a><ul class='methods'><li data-type='method'><a href="module-Data.html#.addCandleData">addCandleData</a></li><li data-type='method'><a href="module-Data.html#.addTradeData">addTradeData</a></li><li data-type='method'><a href="module-Data.html#.candleMarketDataKey">candleMarketDataKey</a></li><li data-type='method'><a href="module-Data.html#.getCandle">getCandle</a></li><li data-type='method'><a href="module-Data.html#.getCandles">getCandles</a></li><li data-type='method'><a href="module-Data.html#.getDefaultCandles">getDefaultCandles</a></li><li data-type='method'><a href="module-Data.html#.getDefaultSymbol">getDefaultSymbol</a></li><li data-type='method'><a href="module-Data.html#.getDefaultTF">getDefaultTF</a></li><li data-type='method'><a href="module-Data.html#.getDefaultTrades">getDefaultTrades</a></li><li data-type='method'><a href="module-Data.html#.getLastPrice">getLastPrice</a></li><li data-type='method'><a href="module-Data.html#.getNumCandles">getNumCandles</a></li><li data-type='method'><a href="module-Data.html#.getNumTrades">getNumTrades</a></li><li data-type='method'><a href="module-Data.html#.getPosition">getPosition</a></li><li data-type='method'><a href="module-Data.html#.getTrade">getTrade</a></li><li data-type='method'><a href="module-Data.html#.getTrades">getTrades</a></li><li data-type='method'><a href="module-Data.html#.isLong">isLong</a></li><li data-type='method'><a href="module-Data.html#.isShort">isShort</a></li><li data-type='method'><a href="module-Data.html#.positionPL">positionPL</a></li><li data-type='method'><a href="module-Data.html#.tradeMarketDataKey">tradeMarketDataKey</a></li><li data-type='method'><a href="module-Data.html#.updatePositionWithTrade">updatePositionWithTrade</a></li></ul></li><li><a href="module-Errors.html">Errors</a><ul class='methods'><li data-type='method'><a href="module-Errors.html#.throwsIfOrderClosesPosition">throwsIfOrderClosesPosition</a></li></ul></li><li><a href="module-Indicators.html">Indicators</a><ul class='methods'><li data-type='method'><a href="module-Indicators.html#.addIndicatorData">addIndicatorData</a></li><li data-type='method'><a href="module-Indicators.html#.findIndicator">findIndicator</a></li><li data-type='method'><a href="module-Indicators.html#.forEachIndicator">forEachIndicator</a></li><li data-type='method'><a href="module-Indicators.html#.indicators">indicators</a></li><li data-type='method'><a href="module-Indicators.html#.indicatorsExec">indicatorsExec</a></li><li data-type='method'><a href="module-Indicators.html#.indicatorsReady">indicatorsReady</a></li><li data-type='method'><a href="module-Indicators.html#.indicatorValues">indicatorValues</a></li><li data-type='method'><a href="module-Indicators.html#.resetIndicators">resetIndicators</a></li><li data-type='method'><a href="module-Indicators.html#.seedPeriodForIndicators">seedPeriodForIndicators</a></li><li data-type='method'><a href="module-Indicators.html#.updateIndicatorData">updateIndicatorData</a></li></ul></li><li><a href="module-Orders.html">Orders</a><ul class='methods'><li data-type='method'><a href="module-Orders.html#.module.exports">module.exports</a></li><li data-type='method'><a href="module-Orders.html#.simulateOrderFill">simulateOrderFill</a></li><li data-type='method'><a href="module-Orders.html#.submitOrder">submitOrder</a></li><li data-type='method'><a href="module-Orders.html#.submitTrade">submitTrade</a></li><li data-type='method'><a href="module-Orders.html#.tradeForOrder">tradeForOrder</a></li></ul></li><li><a href="module-Positions.html">Positions</a><ul class='methods'><li data-type='method'><a href="module-Positions.html#.closeOpenPositions">closeOpenPositions</a></li><li data-type='method'><a href="module-Positions.html#.closePosition">closePosition</a></li><li data-type='method'><a href="module-Positions.html#.closePositionLimit">closePositionLimit</a></li><li data-type='method'><a href="module-Positions.html#.closePositionMarket">closePositionMarket</a></li><li data-type='method'><a href="module-Positions.html#.closePositionWithOrder">closePositionWithOrder</a></li><li data-type='method'><a href="module-Positions.html#.module.exports">module.exports</a></li><li data-type='method'><a href="module-Positions.html#.module.exports">module.exports</a></li><li data-type='method'><a href="module-Positions.html#.module.exports">module.exports</a></li><li data-type='method'><a href="module-Positions.html#.openLongPosition">openLongPosition</a></li><li data-type='method'><a href="module-Positions.html#.openLongPositionLimit">openLongPositionLimit</a></li><li data-type='method'><a href="module-Positions.html#.openLongPositionMarket">openLongPositionMarket</a></li><li data-type='method'><a href="module-Positions.html#.openPosition">openPosition</a></li><li data-type='method'><a href="module-Positions.html#.openPositionLimit">openPositionLimit</a></li><li data-type='method'><a href="module-Positions.html#.openPositionMarket">openPositionMarket</a></li><li data-type='method'><a href="module-Positions.html#.openPositionWithOrder">openPositionWithOrder</a></li><li data-type='method'><a href="module-Positions.html#.openShortPosition">openShortPosition</a></li><li data-type='method'><a href="module-Positions.html#.openShortPositionLimit">openShortPositionLimit</a></li><li data-type='method'><a href="module-Positions.html#.openShortPositionMarket">openShortPositionMarket</a></li><li data-type='method'><a href="module-Positions.html#.updateLongPosition">updateLongPosition</a></li><li data-type='method'><a href="module-Positions.html#.updateLongPositionLimit">updateLongPositionLimit</a></li><li data-type='method'><a href="module-Positions.html#.updateLongPositionMarket">updateLongPositionMarket</a></li><li data-type='method'><a href="module-Positions.html#.updatePosition">updatePosition</a></li><li data-type='method'><a href="module-Positions.html#.updatePositionLimit">updatePositionLimit</a></li><li data-type='method'><a href="module-Positions.html#.updatePositionMarket">updatePositionMarket</a></li><li data-type='method'><a href="module-Positions.html#.updatePositionWithOrder">updatePositionWithOrder</a></li><li data-type='method'><a href="module-Positions.html#.updateShortPosition">updateShortPosition</a></li><li data-type='method'><a href="module-Positions.html#.updateShortPositionLimit">updateShortPositionLimit</a></li><li data-type='method'><a href="module-Positions.html#.updateShortPositionMarket">updateShortPositionMarket</a></li></ul></li><li><a href="module-UpdateHandlers.html">UpdateHandlers</a><ul class='methods'><li data-type='method'><a href="module-UpdateHandlers.html#.onCandle">onCandle</a></li><li data-type='method'><a href="module-UpdateHandlers.html#.onCandleUpdate">onCandleUpdate</a></li><li data-type='method'><a href="module-UpdateHandlers.html#.onPriceUpdate">onPriceUpdate</a></li><li data-type='method'><a href="module-UpdateHandlers.html#.onSeedCandle">onSeedCandle</a></li><li data-type='method'><a href="module-UpdateHandlers.html#.onSeedCandleUpdate">onSeedCandleUpdate</a></li><li data-type='method'><a href="module-UpdateHandlers.html#.onSeedTrade">onSeedTrade</a></li><li data-type='method'><a href="module-UpdateHandlers.html#.onTrade">onTrade</a></li></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#defineStrategy">defineStrategy</a></li><li><a href="global.html#positionPL">positionPL</a></li></ul>
</nav>

<div id="main">
    

    



    


    <section class="package">
        <h3> </h3>		
    </section>









    



    <section class="readme usertext">
        <article><h2>Bitfinex Honey Framework Trading Strategy Library for Node.JS</h2>
<p><a href="https://travis-ci.org/bitfinexcom/bfx-hf-strategy"><img src="https://travis-ci.org/bitfinexcom/bfx-hf-strategy.svg?branch=master" alt="Build Status"></a></p>
<p>This repo serves as a framework for creating trading bots/strategies on the Bitfinex platform. It consists of a set of order methods and an architecture compatible with <code>bfx-hf-data-server</code> and <code>bfx-hf-backtest</code> for backtests on historical candle/trade data, which can be transitioned seamlessly to trading on the live markets.</p>
<p>Strategies written using this framework must define a set of update methods, called on each tick (with either a trade or a candle), along with a set of indicators which are automatically updated on each tick. The indicators are made available to the strategy methods, and can be queried to direct trading behavior.</p>
<h3>Features</h3>
<ul>
<li>Event-driven design approach allowing strategies to react to market updates in real-time</li>
<li>Compatibility with <code>bfx-hf-backtest</code> for backtest execution</li>
<li>Compatibility with <code>bfx-hf-strategy-exec</code> for execution on live markets</li>
</ul>
<h3>Installation</h3>
<pre class="prettyprint source lang-bash"><code>npm i --save bfx-hf-strategy
</code></pre>
<h3>Defining a Strategy</h3>
<p>The <code>define</code> method is provided to construct a trading strategy from a set of indicators &amp; update methods. Strategies created with it can be used with <code>bfx-hf-backtest</code> or with the <code>exec</code> method to run on the live market. An example strategy follows below:</p>
<pre class="prettyprint source lang-js"><code>const { SYMBOLS, TIME_FRAMES } = require('bfx-hf-util')
const { EMA } = require('bfx-hf-indicators')

HFS.define({
  id: 'ema_cross',
  name: 'ema_cross',
  symbol: SYMBOLS.BTC_USD,
  tf: TIME_FRAMES.ONE_MINUTE,

  indicators: {
    emaL: new EMA([100]),
    emaS: new EMA([20])
  },

  onEnter: require('./on_enter'),
  onUpdateLong: require('./on_update_long'),
  onUpdateShort: require('./on_update_short')
})
</code></pre>
<p>The above strategy defines two EMA indicators, <code>emaL</code> and <code>emaS</code>, with periods of 100 and 20 respectively, and 3 update methods; In total, 5 update methods are available:</p>
<ul>
<li><code>onEnter</code> - called when no position is open</li>
<li><code>onUpdateLong</code> - called when a long position is open</li>
<li><code>onUpdateShort</code> - called when a short position is open</li>
<li><code>onUpdate</code> - called when any position is open</li>
<li><code>onPriceUpdate</code> - called on every tick</li>
</ul>
<h3>Update Handlers</h3>
<p>All update handlers must be asynchronous, and receive the same arguments of <code>(state = {}, update = {})</code>. The update has the following fields:</p>
<ul>
<li><code>type</code> - 'candle' or 'trade', indicating which fields are available</li>
<li><code>mts</code> - timestamp, in ms</li>
<li><code>price</code> - candle or trade price (depends on <code>candlePrice</code> strategy setting)</li>
<li>for candles, <code>open</code>, <code>high</code>, <code>low</code>, <code>close</code>, and <code>vol</code> are provided</li>
</ul>
<p>Update handlers must return the next state object after performing any actions, or the current state object if no modifications were made.</p>
<p>The <code>state</code> object can be queried for historical candle data, indicators &amp; indicator values, open positions, and previous strategy trades. Various helpers are provided to query this data; for an example, see the EMA cross example <code>onEnter</code> handler below:</p>
<pre class="prettyprint source lang-js"><code>const _get = require('lodash/get')
const HFS = require('bfx-hf-strategy')

module.exports = async (state = {}, update = {}) => {
  const { price, mts } = update
  const i = HFS.indicators(state)
  const iv = HFS.indicatorValues(state)
  const { emaS } = i // full indicator object
  const l = iv.emaL
  const s = iv.emaS

  // Note that the default strategy symbol is used if no symbol is specified
  if (emaS.crossed(l)) {
    if (s > l) {
      return HFS.openLongPositionMarket(state, {
        mtsCreate: mts,
        amount: 1,
        price
      })
    } else {
      return HFS.openShortPositionMarket(state, {
        mtsCreate: mts,
        amount: 1,
        price
      })
    }
  }

  return state
}
</code></pre>
<h3>Managing Positions</h3>
<p>Within the update handlers, several async helpers are available to open/update/close positions:</p>
<ul>
<li><code>openLongPositionMarket(state, args = {})</code></li>
<li><code>openLongPositionLimit(state, args = {})</code></li>
<li><code>openLongPosition(state, args = {})</code></li>
<li><code>openShortPositionMarket(state, args = {})</code></li>
<li><code>openShortPositionLimit(state, args = {})</code></li>
<li><code>openShortPosition(state, args = {})</code></li>
<li><code>openPosition(state, args = {})</code></li>
<li><code>updateLongPositionMarket(state, args = {})</code></li>
<li><code>updateLongPositionLimit(state, args = {})</code></li>
<li><code>updateLongPosition(state, args = {})</code></li>
<li><code>updateShortPositionMarket(state, args = {})</code></li>
<li><code>updateShortPositionLimit(state, args = {})</code></li>
<li><code>updateShortPosition(state, args = {})</code></li>
<li><code>updatePosition(state, args = {})</code></li>
<li><code>closePositionMarket(state, args = {})</code></li>
<li><code>closePositionLimit(state, args = {})</code></li>
<li><code>closePosition(state, args = {})</code></li>
</ul>
<p>The <code>price</code> and <code>mtsCreate</code> timestamp must both be provided to all update handlers, even those operating with MARKET orders, in order to record the price and timestamp during backtests. If these are not provided, backtests run via <code>bfx-hf-backtest</code> will fail.</p>
<h3>Executing on Live Markets</h3>
<p>To run a strategy on the live marketplace, refer to the <a href="https://github.com/bitfinexcom/bfx-hf-strategy-exec">bfx-hf-strategy-exec</a> documentation.</p></article>
    </section>






    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Fri Mar 13 2020 23:38:45 GMT+0700 (Indochina Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>